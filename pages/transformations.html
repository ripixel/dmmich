<!DOCTYPE html>
<html lang="en">
{{> head}}

<body>
    {{> header}}
    <main>
        <section class="page-header">
            <div class="container">
                <h1>{{content.header.heading}} <span>{{content.header.heading_accent}}</span></h1>
                <p>{{content.header.subtitle}}</p>
            </div>
        </section>

        <section class="section">
            <div class="container">
                <div class="transformations-grid">
                    {{#each content.items}}
                    <div class="transformation-card">
                        <div class="transformation-card__images">
                            <div class="transformation-card__image-col">
                                <img src="{{this.before_image}}" alt="{{this.name}} — before" loading="lazy">
                                <span class="transformation-card__label">Before</span>
                            </div>
                            <div class="transformation-card__image-col">
                                <img src="{{this.after_image}}" alt="{{this.name}} — after" loading="lazy">
                                <span class="transformation-card__label">After</span>
                            </div>
                        </div>
                        <div class="transformation-card__body">
                            <h3 class="transformation-card__name">{{this.name}}</h3>
                            <ul class="transformation-card__stats">
                                {{#each this.stats}}
                                <li>
                                    <span class="transformation-card__stat-value">{{this.value}}</span>
                                    <span class="transformation-card__stat-label">{{this.label}}</span>
                                </li>
                                {{/each}}
                            </ul>
                            <p class="transformation-card__story">{{this.story}}</p>
                        </div>
                    </div>
                    {{/each}}
                </div>
            </div>
        </section>

        <section class="cta-banner">
            <div class="container">
                <h2>{{content.cta.heading}}</h2>
                <p>{{content.cta.body}}</p>
                <a href="/contact" class="btn">{{content.cta.cta_text}}</a>
            </div>
        </section>
    </main>
    {{> footer}}
    {{> structured-data}}

    <!-- Lightbox overlay -->
    <div class="lightbox-overlay" id="lightbox">
        <button class="lightbox-overlay__close" id="lightbox-close" aria-label="Close">&times;</button>
        <div class="lightbox-overlay__content" id="lightbox-content"></div>
    </div>

    <script>
        (function () {
            var overlay = document.getElementById('lightbox');
            var content = document.getElementById('lightbox-content');
            var closeBtn = document.getElementById('lightbox-close');
            var touchStartY = 0;
            var touchDeltaY = 0;

            function lockScroll() {
                document.documentElement.style.overflow = 'hidden';
                document.body.style.overflow = 'hidden';
            }

            function unlockScroll() {
                document.documentElement.style.overflow = '';
                document.body.style.overflow = '';
            }

            function closeLightbox() {
                overlay.classList.remove('active');
                content.style.transform = '';
                content.style.opacity = '';
                unlockScroll();
            }

            // Open: attach to each transformation card
            document.querySelectorAll('.transformations-grid .transformation-card').forEach(function (card) {
                card.addEventListener('click', function () {
                    content.innerHTML = card.innerHTML;
                    overlay.classList.add('active');
                    lockScroll();
                });
            });

            // Close: button
            closeBtn.addEventListener('click', closeLightbox);

            // Close: tap on backdrop (not on content)
            overlay.addEventListener('click', function (e) {
                if (e.target === overlay) closeLightbox();
            });

            // Close: Escape key
            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape') closeLightbox();
            });

            // Swipe-to-dismiss on mobile
            overlay.addEventListener('touchstart', function (e) {
                touchStartY = e.touches[0].clientY;
                touchDeltaY = 0;
            }, { passive: true });

            overlay.addEventListener('touchmove', function (e) {
                touchDeltaY = e.touches[0].clientY - touchStartY;
                var abs = Math.abs(touchDeltaY);
                if (abs > 10) {
                    content.style.transform = 'translateY(' + touchDeltaY + 'px)';
                    content.style.opacity = Math.max(0.2, 1 - abs / 300);
                }
            }, { passive: true });

            overlay.addEventListener('touchend', function () {
                if (Math.abs(touchDeltaY) > 80) {
                    closeLightbox();
                } else {
                    content.style.transform = '';
                    content.style.opacity = '';
                }
            });
        })();
    </script>
</body>

</html>